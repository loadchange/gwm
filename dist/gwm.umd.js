(function(p,u){typeof exports=="object"&&typeof module<"u"?module.exports=u():typeof define=="function"&&define.amd?define(u):(p=typeof globalThis<"u"?globalThis:p||self,p.gwm=u())})(this,function(){"use strict";class p{constructor({txt:t=`${new Date().toLocaleDateString()} Top secret`,x:n=0,y:o=50,font:r="Arial",color:a="#000",fontSize:c=12,alpha:s=.1,width:h=158,height:d=100,angle:l=-15}){this.txt=t,this.width=h,this.height=d,this.x=n,this.y=o,this.font=r,this.fontSize=c,this.color=a,this.alpha=s,this.angle=l}}class u{constructor(t){this.watermark=t}render(){const{txt:t,x:n,y:o,width:r,height:a,color:c,font:s,fontSize:h,alpha:d,angle:l}=this.watermark,i=`<svg xmlns="http://www.w3.org/2000/svg" width="${r}px" height="${a}px">
                <text x="${n}px" y="${o}px" dy="${h}px"
                    text-anchor="start"
                    stroke="${c}"
                    stroke-opacity="${d}"
                    fill="none"
                    transform="rotate(${l},${n} ${o})"
                    font-weight="100"
                    font-size="${h}"
                    font-family="${s}"
                    >
                    ${t}
                </text>
            </svg>`;return`data:image/svg+xml;base64,${window.btoa(unescape(encodeURIComponent(i)))}`}}class b{constructor(t){this.watermark=t;const{width:n,height:o}=t;this.canvas=document.createElement("canvas"),this.canvas.setAttribute("width",`${n}`),this.canvas.setAttribute("height",`${o}`)}escapeSpecialCharacters(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}render(){const{x:t,y:n,width:o,height:r,font:a,color:c,fontSize:s,alpha:h,angle:d}=this.watermark,l=this.escapeSpecialCharacters(this.watermark.txt),i=this.canvas.getContext("2d");if(i===null)throw new Error("getContext error");return i.clearRect(0,0,o,r),i.textBaseline="top",i.textAlign="left",i.fillStyle=c,i.globalAlpha=h,i.font=`${s}px ${a}`,i.translate(t,n),i.rotate(Math.PI/180*d),i.translate(-t,-n-s),i.fillText(l,t,n+s),this.canvas.toDataURL()}}const x=e=>e.replace(/([A-Z])/g,"_$1").toLowerCase(),y=e=>e in document.documentElement.style,g=(...e)=>{const[t,...n]=e.filter(o=>o);return Object.assign.apply(null,[t,...n])},m=(e,t,n)=>{const o=g(e.style,t);for(const r in o){if(r==="position"&&e.style.position)continue;if(n==="normal"){e.style[r]=o[r];continue}if(e.style.setProperty){e.style.setProperty(r,t[r],"important");continue}const a=e.getAttribute("style"),c=[x(r),`${t[r]}!important;`].join(":");e.setAttribute("style",[a,c].join(" ").trim())}return e};class S{constructor(t){this.watermark=t}createItem(){const{txt:t,x:n,y:o,font:r,color:a,fontSize:c,alpha:s,angle:h,width:d,height:l}=this.watermark,i=document.createElement("div");m(i,Object.create({position:"relative",width:d+"px",height:l+"px",flex:`0 0 ${d}px`,overflow:"hidden",pointerEvents:"none"}),"normal");const w=document.createElement("span");return w.innerHTML=t,m(w,Object.create({position:"absolute",top:`${o}px`,left:`${n}px`,fontFamily:r,fontSize:`${c}px`,color:a,lineHeight:1.5,opacity:s,fontWeight:400,transform:`rotate(${h}deg)`,transformOrigin:"0 0",userSelect:"none",whiteSpace:"nowrap",overflow:"hidden"}),"normal"),i.appendChild(w),i}render(t){let n=0;const{width:o,height:r}=this.watermark,{clientWidth:a,clientHeight:c}=document.documentElement||document.body,s=Math.ceil(a/o),h=Math.ceil(c/r),d=t||s*h,l=document.createElement("div");for(m(l,Object.create({display:"flex",flexWrap:"wrap",width:`${o*s}px`,height:`${r*h}px`}),"normal");n<d;n++)l.appendChild(this.createItem());return l}}const v=MutationObserver||WebKitMutationObserver||MozMutationObserver;function $(e,t,n){const o=["DOMAttrModified","DOMAttributeNameChanged","DOMCharacterDataModified","DOMElementNameChanged","DOMNodeInserted","DOMNodeInsertedIntoDocument","DOMNodeRemoved","DOMNodeRemovedFromDocument","DOMSubtreeModified"];return o.map(r=>e.addEventListener(r,()=>n(),!1)),document.body.addEventListener("DOMSubtreeModified",()=>n(),!1),{containerObserver:{disconnect:()=>t.removeEventListener("DOMSubtreeModified",()=>n(),!1)},targetObserver:{disconnect:()=>o.map(r=>e.removeEventListener(r,()=>n(),!1))}}}const O=(e,t,n)=>{if(!v)return $(e,t,n);const o=new v(a=>{a.forEach(c=>{c.removedNodes.forEach(s=>{s===e&&n()})})});o.observe(t,{childList:!0});const r=new MutationObserver(n);return r.observe(e,{characterData:!0,attributes:!0,childList:!0,subtree:!0}),{containerObserver:o,targetObserver:r}},D=e=>{const{containerObserver:t,targetObserver:n}=e;t.disconnect(),n.disconnect()},E=e=>{const{gwmDom:t}=e,n=Object.create(e.opts.css);t&&t.remove();const o=document.createElement("div");return y("pointerEvents")&&(n.pointerEvents="none",n.zIndex=parseInt(`${n.zIndex}`,10)>0?n.zIndex:"999999"),m(o,n),o},M=Object.create({position:"fixed",top:0,right:0,bottom:0,left:0,overflow:"hidden",zIndex:-10,backgroundRepeat:"no-repeat",display:"block",opacity:"1"});var f=(e=>(e.CANVAS="canvas",e.SVG="svg",e.ELEMENT="element",e))(f||{});const C=(e,t)=>{switch(e){case f.CANVAS:return new b(t);case f.SVG:return new u(t);default:return new S(t)}},L=e=>{if(typeof e=="string"){const t=document.querySelector(e);return t||document.body}return e};class A{creation(t={txt:`${new Date().toLocaleDateString()} Top secret`}){this.opts=t,this.opts.css=g(M,t.css),this.cancel();const{mode:n,watch:o,container:r=document.body}=t;this.wrap=L(r),this.wrap!==document.body&&(this.opts.css.position="absolute",m(this.wrap,Object.create({position:"relative"}))),this.gwmDom=E(this);const a=new p(t),s=C(n||f.SVG,a).render();n===f.ELEMENT?this.gwmDom.appendChild(s):this.gwmDom.style.background=`url("${s}")`;const h=this.wrap.firstChild;h?this.wrap.insertBefore(this.gwmDom,h):this.wrap.appendChild(this.gwmDom),typeof o=="boolean"&&!o&&(this.observer=this.observing()),t.destroy&&(this.creation=d=>d)}observing(){return O(this.gwmDom,this.wrap,()=>this.creation(this.opts))}cancel(){this.observer&&D(this.observer)}}return new A});
//# sourceMappingURL=gwm.umd.js.map
