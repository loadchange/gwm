(function(l,p){typeof exports=="object"&&typeof module<"u"?module.exports=p():typeof define=="function"&&define.amd?define(p):(l=typeof globalThis<"u"?globalThis:l||self,l.gwm=p())})(this,(function(){"use strict";class l{constructor({txt:t=`${new Date().toLocaleDateString()} Top secret`,x:n=0,y:o=50,font:r="Arial",color:a="#000",fontSize:c=12,alpha:i=.1,width:d=158,height:s=100,angle:h=-15}){this.txt=t,this.width=d,this.height=s,this.x=n,this.y=o,this.font=r,this.fontSize=c,this.color=a,this.alpha=i,this.angle=h}}class p{constructor(t){this.watermark=t}render(){const{txt:t,width:n,height:o,color:r,font:a,fontSize:c,alpha:i,angle:d}=this.watermark,s=n/2,h=o/2,L=`<svg xmlns="http://www.w3.org/2000/svg" width="${n}px" height="${o}px">
                <text x="${s}px" y="${h}px"
                    text-anchor="middle"
                    dominant-baseline="middle"
                    stroke="${r}"
                    stroke-opacity="${i}"
                    fill="none"
                    transform="rotate(${d},${s} ${h})"
                    font-weight="100"
                    font-size="${c}"
                    font-family="${a}"
                    >
                    ${t}
                </text>
            </svg>`;return`data:image/svg+xml;base64,${window.btoa(unescape(encodeURIComponent(L)))}`}}class g{constructor(t){this.watermark=t;const{width:n,height:o}=t;this.canvas=document.createElement("canvas"),this.canvas.setAttribute("width",`${n}`),this.canvas.setAttribute("height",`${o}`)}escapeSpecialCharacters(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}render(){const{width:t,height:n,font:o,color:r,fontSize:a,alpha:c,angle:i}=this.watermark,d=this.escapeSpecialCharacters(this.watermark.txt),s=this.canvas.getContext("2d");if(s===null)throw new Error("getContext error");return s.clearRect(0,0,t,n),s.textBaseline="middle",s.textAlign="center",s.fillStyle=r,s.globalAlpha=c,s.font=`${a}px ${o}`,s.translate(t/2,n/2),s.rotate(Math.PI/180*i),s.fillText(d,0,0),this.canvas.toDataURL()}}const v=e=>e.replace(/([A-Z])/g,"_$1").toLowerCase(),b=e=>e in document.documentElement.style,f=(...e)=>{const[t,...n]=e.filter(o=>o);return Object.assign.apply(null,[t,...n])},u=(e,t,n)=>{const o=f(e.style,t);for(const r in o){if(r==="position"&&e.style.position)continue;if(n==="normal"){e.style.setProperty(r,o[r]);continue}if(e.style.setProperty){e.style.setProperty(r,t[r],"important");continue}const a=e.getAttribute("style"),c=[v(r),`${t[r]}!important;`].join(":");e.setAttribute("style",[a,c].join(" ").trim())}return e};class y{constructor(t){this.watermark=t}createItem(){const{txt:t,font:n,color:o,fontSize:r,alpha:a,angle:c,width:i,height:d}=this.watermark,s=document.createElement("div");u(s,Object.create({position:"relative",width:i+"px",height:d+"px",flex:`0 0 ${i}px`,overflow:"hidden",pointerEvents:"none"}),"normal");const h=document.createElement("span");return h.innerHTML=t,u(h,Object.create({position:"absolute",top:"50%",left:"50%",fontFamily:n,fontSize:`${r}px`,color:o,lineHeight:1.5,opacity:a,fontWeight:400,transform:`translate(-50%, -50%) rotate(${c}deg)`,transformOrigin:"center center",userSelect:"none",whiteSpace:"nowrap",overflow:"hidden"}),"normal"),s.appendChild(h),s}render(t){let n=0;const{width:o,height:r}=this.watermark,{clientWidth:a,clientHeight:c}=document.documentElement||document.body,i=Math.ceil(a/o),d=Math.ceil(c/r),s=t||i*d,h=document.createElement("div");for(u(h,Object.create({display:"flex",flexWrap:"wrap",width:`${o*i}px`,height:`${r*d}px`}),"normal");n<s;n++)h.appendChild(this.createItem());return h}}const w=MutationObserver||WebKitMutationObserver||MozMutationObserver;function x(e,t,n){const o=["DOMAttrModified","DOMAttributeNameChanged","DOMCharacterDataModified","DOMElementNameChanged","DOMNodeInserted","DOMNodeInsertedIntoDocument","DOMNodeRemoved","DOMNodeRemovedFromDocument","DOMSubtreeModified"];return o.map(r=>e.addEventListener(r,()=>n(),!1)),document.body.addEventListener("DOMSubtreeModified",()=>n(),!1),{containerObserver:{disconnect:()=>t.removeEventListener("DOMSubtreeModified",()=>n(),!1)},targetObserver:{disconnect:()=>o.map(r=>e.removeEventListener(r,()=>n(),!1))}}}const S=(e,t,n)=>{if(!w)return x(e,t,n);const o=new w(a=>{a.forEach(c=>{c.removedNodes.forEach(i=>{i===e&&n()})})});o.observe(t,{childList:!0});const r=new MutationObserver(n);return r.observe(e,{characterData:!0,attributes:!0,childList:!0,subtree:!0}),{containerObserver:o,targetObserver:r}},O=e=>{const{containerObserver:t,targetObserver:n}=e;t.disconnect(),n.disconnect()},D=e=>{const{gwmDom:t}=e,n=Object.create(e.opts.css);t&&t.remove();const o=document.createElement("div");return b("pointerEvents")&&(n.pointerEvents="none",n.zIndex=parseInt(`${n.zIndex}`,10)>0?n.zIndex:"999999"),u(o,n),o},E=Object.create({position:"fixed",top:0,right:0,bottom:0,left:0,overflow:"hidden",zIndex:-10,backgroundRepeat:"no-repeat",display:"block",opacity:"1"});var m=(e=>(e.CANVAS="canvas",e.SVG="svg",e.ELEMENT="element",e))(m||{});const M=(e,t)=>{switch(e){case m.CANVAS:return new g(t);case m.SVG:return new p(t);default:return new y(t)}},$=e=>{if(typeof e=="string"){const t=document.querySelector(e);return t||document.body}return e};class C{creation(t={txt:`${new Date().toLocaleDateString()} Top secret`}){this.opts=t,this.opts.css=f(E,t.css),this.cancel();const{mode:n,watch:o,container:r=document.body}=t;this.wrap=$(r),this.wrap!==document.body&&(this.opts.css.position="absolute",u(this.wrap,Object.create({position:"relative"}))),this.gwmDom=D(this);const a=new l(t),i=M(n||m.SVG,a).render();n===m.ELEMENT?this.gwmDom.appendChild(i):this.gwmDom.style.background=`url("${i}")`;const d=this.wrap.firstChild;d?this.wrap.insertBefore(this.gwmDom,d):this.wrap.appendChild(this.gwmDom),typeof o=="boolean"&&!o&&(this.observer=this.observing()),t.destroy&&(this.creation=s=>s)}observing(){return S(this.gwmDom,this.wrap,()=>this.creation(this.opts))}cancel(){this.observer&&O(this.observer)}}return new C}));
//# sourceMappingURL=gwm.umd.js.map
